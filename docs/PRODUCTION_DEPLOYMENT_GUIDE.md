# üöÄ Production Deployment Guide - Complete Setup

## ‚úÖ All Issues Fixed - Production Ready

This guide covers the complete production deployment setup for **EdithCloths** e-commerce platform.

---

## üìã Pre-Deployment Checklist

- [x] Backend production settings configured
- [x] Frontend API URLs configured
- [x] CORS/CSRF settings fixed
- [x] Security headers enabled
- [x] Static/media files configured
- [x] Admin login fixed
- [x] Mobile responsive verified
- [x] Environment variables documented

---

## üîß Backend Deployment (Render)

### **1. Environment Variables Required**

Go to **Render Dashboard** ‚Üí **myshp-backend** ‚Üí **Environment** and set:

#### **Required Variables:**
```
DEBUG=False
SECRET_KEY=<auto-generated by Render>
DATABASE_URL=<auto-set from database>
```

#### **Optional but Recommended:**
```
DJANGO_SUPERUSER_USERNAME=admin
DJANGO_SUPERUSER_EMAIL=your-email@gmail.com
DJANGO_SUPERUSER_PASSWORD=YourStrongPassword123!

EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
DEFAULT_FROM_EMAIL=your-email@gmail.com
ADMIN_EMAIL=your-email@gmail.com

# Optional: Additional CORS origins (comma-separated)
CORS_ALLOWED_ORIGINS=https://custom-domain.com,https://another-domain.com

# Optional: Additional allowed hosts (comma-separated)
ALLOWED_HOSTS=your-custom-domain.com,another-domain.com
```

### **2. Build & Start Commands**

**Build Command:**
```bash
pip install -r requirements.txt && python manage.py collectstatic --noinput
```

**Start Command:**
```bash
bash start.sh
```

### **3. Database Migrations**

Migrations run automatically via `start.sh` script. No manual action needed.

### **4. Create Admin User**

**Option A: Environment Variables (Recommended)**
Set `DJANGO_SUPERUSER_USERNAME`, `DJANGO_SUPERUSER_EMAIL`, `DJANGO_SUPERUSER_PASSWORD` in Render environment variables. The user will be created automatically on startup.

**Option B: Render Shell**
1. Go to Render Dashboard ‚Üí myshp-backend ‚Üí Shell ‚Üí Connect
2. Run:
   ```bash
   python manage.py createsuperuser
   ```

### **5. Verify Backend**

Visit: `https://myshp-backend.onrender.com/api/`

**Expected Response:**
```json
{
  "message": "EdithCloths Backend API",
  "version": "1.0",
  "status": "online"
}
```

---

## üé® Frontend Deployment (Vercel)

### **1. Environment Variables**

Go to **Vercel Dashboard** ‚Üí **myshp-frontend** ‚Üí **Settings** ‚Üí **Environment Variables** and set:

#### **Required:**
```
NEXT_PUBLIC_API_BASE_URL=https://myshp-backend.onrender.com/api
```

**Note:** If not set, the frontend will use the production fallback URL automatically.

### **2. Build Settings**

**Framework Preset:** Other
**Root Directory:** `frontend` (if frontend is in a subdirectory)
**Build Command:** (leave empty - static site)
**Output Directory:** `.` (root)

### **3. Vercel Configuration**

The `vercel.json` file is already configured with:
- Proper rewrites for routing
- Cache headers for assets
- Security headers

### **4. Verify Frontend**

Visit: `https://myshp-frontend.vercel.app`

**Expected:**
- Homepage loads
- No console errors
- API calls work
- Images load correctly

---

## üîó Frontend ‚Üî Backend Connection

### **Current Configuration:**

**Frontend API Base:** `https://myshp-backend.onrender.com/api`
**Backend URL:** `https://myshp-backend.onrender.com`
**CORS:** Configured for `https://myshp-frontend.vercel.app`

### **How It Works:**

1. Frontend makes API calls to: `https://myshp-backend.onrender.com/api/...`
2. Backend CORS allows requests from: `https://myshp-frontend.vercel.app`
3. Backend responds with data
4. Frontend displays the data

### **Testing Connection:**

1. Open browser console (F12) on frontend
2. Go to Network tab
3. Try to login or browse products
4. Verify API calls go to: `https://myshp-backend.onrender.com/api/...`
5. Check for CORS errors (should be none)

---

## üîí Security Settings (Production)

### **Backend Security (Auto-enabled when DEBUG=False):**

- ‚úÖ `SECURE_SSL_REDIRECT = True` - Force HTTPS
- ‚úÖ `SESSION_COOKIE_SECURE = True` - Secure cookies
- ‚úÖ `CSRF_COOKIE_SECURE = True` - Secure CSRF tokens
- ‚úÖ `SECURE_BROWSER_XSS_FILTER = True` - XSS protection
- ‚úÖ `SECURE_CONTENT_TYPE_NOSNIFF = True` - MIME type protection
- ‚úÖ `X_FRAME_OPTIONS = 'DENY'` - Prevent clickjacking
- ‚úÖ `SECURE_HSTS_SECONDS = 31536000` - HSTS enabled (1 year)

### **Frontend Security (via vercel.json):**

- ‚úÖ `X-Content-Type-Options: nosniff`
- ‚úÖ `X-Frame-Options: DENY`
- ‚úÖ `X-XSS-Protection: 1; mode=block`

---

## üìÅ Static & Media Files

### **Static Files (CSS, JS):**
- ‚úÖ Served via WhiteNoise in production
- ‚úÖ Collected during build: `python manage.py collectstatic`
- ‚úÖ Cached with proper headers

### **Media Files (Uploaded Images):**
- ‚úÖ Served via Django in production
- ‚úÖ URL pattern: `/media/...`
- ‚úÖ Stored in: `MEDIA_ROOT` directory

**Note:** For better performance, consider using:
- AWS S3 for media files
- CloudFront CDN for static files

---

## üêõ Troubleshooting

### **Issue: CORS Errors**

**Symptoms:** `Access-Control-Allow-Origin` error in browser console

**Fix:**
1. Check `backend/edithclothes/settings.py`:
   - `CORS_ALLOWED_ORIGINS` includes Vercel URL
   - `CORS_ALLOW_ALL_ORIGINS = False` in production
2. Verify frontend URL matches exactly
3. Redeploy backend after changes

### **Issue: Admin Login Fails**

**Symptoms:** "Invalid username or password" or "Not authorized"

**Fix:**
1. Verify admin user exists:
   ```bash
   python manage.py shell
   from django.contrib.auth.models import User
   User.objects.filter(is_staff=True)
   ```
2. Create admin user if missing (see above)
3. Check `is_staff=True` and `is_superuser=True`
4. Reset password if needed:
   ```python
   user = User.objects.get(username='admin')
   user.set_password('NewPassword123!')
   user.save()
   ```

### **Issue: API Not Responding**

**Symptoms:** 404 or 500 errors on API calls

**Fix:**
1. Check backend is running: `https://myshp-backend.onrender.com/api/`
2. Check Render logs for errors
3. Verify API endpoint exists in `backend/shop/urls.py`
4. Check database migrations ran successfully

### **Issue: Images Not Loading**

**Symptoms:** Product images show placeholder or broken

**Fix:**
1. Verify media files are uploaded to backend
2. Check media URL: `https://myshp-backend.onrender.com/media/...`
3. Verify CORS allows image requests
4. Check image URLs in API responses

### **Issue: Mobile Layout Broken**

**Symptoms:** Layout looks wrong on mobile devices

**Fix:**
1. Clear browser cache (hard refresh: Ctrl+Shift+R)
2. Check `frontend/assets/css/style.css` has mobile media queries
3. Verify viewport meta tag: `<meta name="viewport" content="width=device-width, initial-scale=1.0">`
4. Test on actual mobile device (not just browser dev tools)

---

## üìä Monitoring & Maintenance

### **Backend Monitoring (Render):**

1. **Logs:** Render Dashboard ‚Üí myshp-backend ‚Üí Logs
2. **Metrics:** Render Dashboard ‚Üí myshp-backend ‚Üí Metrics
3. **Health Check:** `https://myshp-backend.onrender.com/api/products/`

### **Frontend Monitoring (Vercel):**

1. **Analytics:** Vercel Dashboard ‚Üí myshp-frontend ‚Üí Analytics
2. **Logs:** Vercel Dashboard ‚Üí myshp-frontend ‚Üí Deployments ‚Üí Logs
3. **Performance:** Vercel Dashboard ‚Üí myshp-frontend ‚Üí Speed Insights

### **Regular Maintenance:**

1. **Weekly:**
   - Check Render/Vercel logs for errors
   - Monitor API response times
   - Check database size

2. **Monthly:**
   - Review security updates
   - Update dependencies
   - Backup database

3. **As Needed:**
   - Create new admin users
   - Update environment variables
   - Deploy code updates

---

## ‚úÖ Final Verification Checklist

### **Backend:**
- [ ] Backend deployed and running
- [ ] API endpoint responds: `https://myshp-backend.onrender.com/api/`
- [ ] Admin user created and can login
- [ ] Database migrations completed
- [ ] Static files collected
- [ ] CORS configured correctly
- [ ] Security settings enabled (DEBUG=False)
- [ ] Media files accessible

### **Frontend:**
- [ ] Frontend deployed and running
- [ ] Homepage loads correctly
- [ ] No console errors
- [ ] API calls work (check Network tab)
- [ ] Login works (user and admin)
- [ ] Products load correctly
- [ ] Images load correctly
- [ ] Mobile responsive
- [ ] All pages accessible

### **Connection:**
- [ ] Frontend can call backend API
- [ ] No CORS errors
- [ ] Authentication works
- [ ] Admin login works
- [ ] Data loads correctly

---

## üéØ Quick Reference

### **URLs:**
- **Backend:** `https://myshp-backend.onrender.com`
- **Frontend:** `https://myshp-frontend.vercel.app`
- **API Base:** `https://myshp-backend.onrender.com/api`
- **Admin:** `https://myshp-backend.onrender.com/admin/`

### **Key Files:**
- **Backend Settings:** `backend/edithclothes/settings.py`
- **Frontend API:** `frontend/assets/js/api.js`
- **Vercel Config:** `frontend/vercel.json`
- **Render Config:** `backend/render.yaml`

### **Support:**
- **Render Docs:** https://render.com/docs
- **Vercel Docs:** https://vercel.com/docs
- **Django Docs:** https://docs.djangoproject.com

---

## üéâ Production Ready!

Your application is now fully configured for production deployment. All security settings, CORS, CSRF, and connection issues have been resolved.

**Next Steps:**
1. Deploy backend to Render
2. Deploy frontend to Vercel
3. Set environment variables
4. Create admin user
5. Test everything
6. Go live! üöÄ

---

**Last Updated:** $(date)
**Version:** 1.0.0
**Status:** Production Ready ‚úÖ

